<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>映画推薦システム</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- 入力画面 -->
    <div id="input-area">
        <h1>お好きな映画を3つ選択してください</h1>
        <div class="form-group">
            <label>1つ目の映画:</label>
            <select id="movie1" class="movie-select"><option value="">--- 映画を選択してください ---</option></select>
        </div>
        <div class="form-group">
            <label>2つ目の映画:</label>
            <select id="movie2" class="movie-select"><option value="">--- 映画を選択してください ---</option></select>
        </div>
        <div class="form-group">
            <label>3つ目の映画:</label>
            <select id="movie3" class="movie-select"><option value="">--- 映画を選択してください ---</option></select>
        </div>
        <button onclick="getRecommendations()" class="btn-primary">オススメ映画を表示</button>
    </div>

    <!-- 結果画面 -->
    <div id="result-area" class="hidden">
        <h2 class="result-title">オススメ映画トップ5</h2>
        <ul id="recommend-list"></ul>
        <button onclick="goBack()" class="btn-secondary">選び直す</button>
    </div>

    <script>
        window.onload = async () => {
            const response = await fetch('/get_movies');
            const movies = await response.json();
            const selects = document.querySelectorAll('.movie-select');
            selects.forEach(select => {
                movies.forEach(movie => {
                    const opt = document.createElement('option');
                    opt.value = movie.movieId;
                    opt.textContent = movie.title;
                    select.appendChild(opt);
                });
            });
        };

        async function getRecommendations() {
            const ids = [
                document.getElementById('movie1').value,
                document.getElementById('movie2').value,
                document.getElementById('movie3').value
            ];
            const response = await fetch('/recommend', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ movieIds: ids })
            });
            const data = await response.json();
            
            document.getElementById('input-area').classList.add('hidden');
            const resultArea = document.getElementById('result-area');
            const listElement = document.getElementById('recommend-list');
            
            listElement.innerHTML = '';
            // 番号（index + 1）を付けてリストを作成
            data.recommendations.forEach((title, index) => {
                const li = document.createElement('li');
                li.textContent = `${index + 1}. ${title}`;
                listElement.appendChild(li);
            });
            resultArea.classList.remove('hidden');
        }

        function goBack() {
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('input-area').classList.remove('hidden');
        }
    </script>
</body>
</html>